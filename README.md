# Финальная задача "Распределенный вычислитель арифметических выражений" Спринт 2. Конкурентное программирование

## Описание:

>Пользователь хочет считать арифметические выражения. Он вводит строку 2 + 2 * 2 и хочет получить в ответ 6. Но наши операции сложения и умножения (также деления и вычитания) выполняются "очень-очень" долго. Поэтому вариант, при котором пользователь делает http-запрос и получает в качетсве ответа результат, невозможна. Более того: вычисление каждой такой операции в нашей "альтернативной реальности" занимает "гигантские" вычислительные мощности. Соответственно, каждое действие мы должны уметь выполнять отдельно и масштабировать эту систему можем добавлением вычислительных мощностей в нашу систему в виде новых "машин". Поэтому пользователь, присылая выражение, получает в ответ идентификатор выражения и может с какой-то периодичностью уточнять у сервера "не посчиталость ли выражение"? Если выражение наконец будет вычислено - то он получит результат. Помните, что некоторые части арфиметического выражения можно вычислять параллельно.

### Front-end часть

GUI, который можно представить как 4 страницы:

* Форма ввода арифметического выражения. Пользователь вводит арифметическое выражение и отправляет POST http-запрос с этим выражением на back-end. Примечание: Запросы должны быть идемпотентными. К запросам добавляется уникальный идентификатор. Если пользователь отправляет запрос с идентификатором, который уже отправлялся и был принят к обработке - ответ 200. Возможные варианты ответа:

    * `200. Выражение успешно принято, распаршено и принято к обработке`

    * `400. Выражение невалидно`

    * `500. Что-то не так на back-end. В качестве ответа нужно возвращать id принятного к выполнению выражения.`

* Страница со списком выражений в виде списка с выражениями. Каждая запись на странице содержит статус, выражение, дату его создания и дату заверщения вычисления. Страница получает данные GET http-запрсом с back-end-а
* Страница со списком операций в виде пар: имя операции + время его выполнения (доступное для редактирования поле). Как уже оговаривалось в условии задачи, наши операции выполняются "как будто бы очень долго". Страница получает данные GET http-запрсом с back-end-а. Пользователь может настроить время выполения операции и сохранить изменения.
* Страница со списком вычислительных можностей. Страница получает данные GET http-запросом с сервера в виде пар: имя вычислительного ресурса + выполняемая на нём операция.    

Требования:
Оркестратор может перезапускаться без потери состояния. Все выражения храним в СУБД.
Оркестратор должен отслеживать задачи, которые выполняются слишком долго (вычислитель тоже может уйти со связи) и делать их повторно доступными для вычислений.

### Back-end часть

Состоит из 2 элементов:

* Сервер, который принимает арифметическое выражение, переводит его в набор последовательных задач и обеспечивает порядок их выполнения. Далее будем называть его оркестратором.
* Вычислитель, который может получить от оркестратора задачу, выполнить его и вернуть серверу результат. Далее будем называть его агентом.

**Оркестратор** - Сервер, который имеет следующие endpoint-ы:

* Добавление вычисления арифметического выражения.
* Получение списка выражений со статусами.
* Получение значения выражения по его идентификатору.
* Получение списка доступных операций со временем их выполения.
* Получение задачи для выполения.
* Приём результата обработки данных.

**Агент** - Демон, который получает выражение для вычисления с сервера, вычисляет его и отправляет на сервер результат выражения. При старте демон запускает несколько горутин, каждая из которых выступает в роли независимого вычислителя. Количество горутин регулируется переменной среды.

## Реализация

### Автор

Богданов Данила

#### Связаться со мной

Telegram: `@Dbugdanov`

E-mail: `official.dabogdanov@gmail.com`

### Необходимые требования

| Критерий                                                                                                                                                                                                                                                                                                                                               | описание реализации                                                                                                                                                    |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Существует Readme документ, в котором описано, как запустить систему и как ей пользоваться; Это может быть docker-compose, makefile, подробная инструкция - на ваш вкус. Если вы предоставляете только http-api, то - в Readme описаны примеры запросов с помощью curl-a или любым дргуми понятными образом - примеры полны и понятно как их запустить | Основной Readme документ - этот. система запускается с помощью Docker-контейнера. Предоставлена подробная инструкция. на текущий момент предоставлено только http-api. |
| Программа запускается и все примеры с вычислением арифметических выражений корректно работают                                                                                                                                                                                                                                                          | Примеры для запуска:                                                                                                                                                   |
| Программа запускается и выполняются произвольные примеры с вычислением арифметических выражений                                                                                                                                                                                                                                                        | Комментарий: работают только примеры с операторами + - / * с числами типа int и float. унарные операторы не поддерживаются. Скобки не поддерживаются.                  |
| Можно перезапустить любой компонент системы и система корректно обработает перезапуск (результаты сохранены, система продолжает работать)                                                                                                                                                                                                              | 50/50                                                                                                                                                                  |
| Система предосталяет графический интерфейс для вычисления арифметических выражений                                                                                                                                                                                                                                                                     | в стадии активной разработки                                                                                                                                           |
| Реализован мониторинг воркеров                                                                                                                                                                                                                                                                                                                         | статус воркера и heartbeat                                                                                                                                             |
| Реализован интерфейс для мориторинга воркеров                                                                                                                                                                                                                                                                                                          | в стадии активной                                                                                                                                                      |
| Вам понятна кодовая база и структура проекта                                                                                                                                                                                                                                                                                                           | Старался поддерживать чистую архитектуру                                                                                                                               |
| У системы есть документация со схемами, которая наглядно отвечает на вопрос: Как это все работает                                                                                                                                                                                                                                                      | Ниже в этом readme                                                                                                                                                     |
| Выражение должно иметь возможность выполняться разными агентами                                                                                                                                                                                                                                                                                        | +                                                                                                                                                                      |

### Установка

### Использование

### Схемы

Предполагаемая работа приложения:

>Предисловие.
>Если что то мертвое, то клиенту идет 500 Internal Server Error.
>---
>Часть 1. Самое стандартное действие всем кто зашел на сайт:
>клиент (браузер): "захожу на сайт с калькулятором"
>вебчик: "даю тебе фронтенд. идентифицирую тебя по cookie session https://echo.labstack.com/docs/cookies" и потом во всех запросах к логике калькулятора спрашиваю эту куку, смотрим в kv DB и если там нет такой куки то ~~[пошол нахой]~~ (перевыдать куки). Если куки нет то ~~[пошол нахой]~~ (перевыдать куки)
>клиент: "получил session cookie, сохранил в браузер, передаю всегда с запросом теперь"
>---
>Часть 2. Конфигурация времени выполнения запроса:
>клиент: "по дефолту параметр execTime стоит 100ms, но я могу настроить его хоть до часа"
>вебчик: "твой парамтер execTime привязываю с cookieSession и записываю в kv DB. Если присылаешь setExecTime то меняю на то что ты там прислал"
>клиент: "да, я выставил новый setExecTime, прислал тебе, ты его себе записал."
>---
>Часть 3. Отправка математического выражения:
>клиент: Я хочу скалькулировать своё выражение! Присылаю выражение в формате строки POST запросом"
>вебчик: "принял его по роуту handleNewExpression. первое что я делаю это токенизирую выражение. Если ты прислал какой-то запрещенный символ, возвращаю тебе 400 Bad Request. Если с выражением всё ок, отправляю его на парсинг. парсер разделил выражение на подвыражения и образовал синтаксическое бинарное дерево.
>Синтаксическое бинарное дерево надо распределить по доступным вычислителям. Смотрим сколько вычислителей. Спрашиваем занят ли вычислитель, если свободен то отправляем часть выражения на вычисление, если можно ещё одно выражение отправить
>на вычисление, отправляем и его. Если выражение является подвыражением другого выражения, то после того как получили результат вычисления подвыражения, подставляем результат в выражение и вычисляем уже это
>выражение. Так высчитываем всё полностью, и, конечный результат записываем в базу данных с историей вычисления. если где-то произошла ошибка, то всё выражение отвергаем и в истории отмечаем где ошибка" 


![Untitled-2024-02-23-2110.png|Различные схемы](readme_files%2FUntitled-2024-02-23-2110.png)